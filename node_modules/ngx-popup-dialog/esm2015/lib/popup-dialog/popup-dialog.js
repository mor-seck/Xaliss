/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ComponentFactoryResolver, ElementRef, HostListener, Inject, ReflectiveInjector, ViewChild, ViewContainerRef, ViewEncapsulation, InjectionToken, } from '@angular/core';
import { MAT_DIALOG_DATA, MatDialogConfig, MatDialogRef } from '@angular/material/dialog';
/** @type {?} */
export const POPUP_DIALOG_CLOSE = new InjectionToken('POPUP_DIALOG_CLOSE');
/**
 * @record
 */
export function PopupDialogConfig() { }
if (false) {
    /** @type {?} */
    PopupDialogConfig.prototype.triggeringElement;
    /** @type {?} */
    PopupDialogConfig.prototype.component;
}
/**
 * @record
 */
export function PopupDialogData() { }
if (false) {
    /** @type {?} */
    PopupDialogData.prototype.config;
    /** @type {?} */
    PopupDialogData.prototype.data;
}
/**
 * @record
 */
function OutOfViewport() { }
if (false) {
    /** @type {?} */
    OutOfViewport.prototype.top;
    /** @type {?} */
    OutOfViewport.prototype.topIfScaleToTop;
    /** @type {?} */
    OutOfViewport.prototype.left;
    /** @type {?} */
    OutOfViewport.prototype.bottom;
    /** @type {?} */
    OutOfViewport.prototype.right;
    /** @type {?} */
    OutOfViewport.prototype.any;
    /** @type {?} */
    OutOfViewport.prototype.all;
}
export class PopupDialog {
    /**
     * @param {?} componentFactoryResolver
     * @param {?} dialogRef
     * @param {?} data
     */
    constructor(componentFactoryResolver, dialogRef, data) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.dialogRef = dialogRef;
        this.visible = false;
        this.isOpened = false;
        this.scaleBottomToTop = false;
        this.scrollBoundedFunction = this.onScroll.bind(this);
        // set events handled to true to ignore event when popup opened for the first time.
        this.mouseDownHandled = true;
        this.mouseUpHandled = true;
        this.clickHandled = true;
        this.config = data.config;
        this.data = data.data;
        this.direction = data.config.direction || (/** @type {?} */ (getComputedStyle(this.config.triggeringElement).direction));
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onScroll(event) {
        this.positionDialogWhereTriggeringElement();
        this.positionDialogUpIfBottomOutsideViewport();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseDown(event) {
        this.handleMouseEvent(event);
        this.mouseDownHandled = true;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onMouseUp(event) {
        if (this.mouseDownHandled || this.clickHandled) {
            this.mouseDownHandled = false;
            this.clickHandled = false;
            return;
        }
        this.handleMouseEvent(event);
        this.mouseUpHandled = true;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    onClick(event) {
        if (this.mouseDownHandled || this.mouseUpHandled) {
            this.mouseDownHandled = false;
            this.mouseUpHandled = false;
            return;
        }
        this.handleMouseEvent(event);
        this.clickHandled = true;
    }
    /**
     * @param {?} event
     * @return {?}
     */
    handleMouseEvent(event) {
        if (!this.isOpened)
            return;
        // Clicking on element will trigger this callback function multiple times (for mouse down, up and click)
        // Therefor, we stop execution if we get the same event target.
        // We reset the lastClickedElement after 100 ms
        if (this.lastClickedElement == event.target)
            return;
        this.lastClickedElement = event.target;
        setTimeout((/**
         * @return {?}
         */
        () => {
            this.lastClickedElement = null;
        }), 200);
        /** @type {?} */
        var container = this.dialogContainerRef.nativeElement;
        if (container === event.target || this.childOf(event.target, container)) {
            return;
        }
        if (this.config.suppressCloseOnClickSelectors) {
            for (let i = 0; i < this.config.suppressCloseOnClickSelectors.length; i++) {
                /** @type {?} */
                const selector = this.config.suppressCloseOnClickSelectors[i];
                /** @type {?} */
                const elements = document.querySelectorAll(selector);
                for (let i = 0; i < elements.length; i++) {
                    /** @type {?} */
                    const elem = elements[i];
                    if (elem === event.target || this.childOf(event.target, elem)) {
                        return;
                    }
                }
            }
        }
        this.closeDialog();
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        this.registerOrUnregisterAncestrosScrollEvent();
        this.loadComponent();
        this.dialogRef.beforeClose().subscribe((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            this.visible = false;
            this.isOpened = false;
        }));
        this.dialogRef.afterOpen().subscribe((/**
         * @param {?} x
         * @return {?}
         */
        x => {
            this.isOpened = true;
        }));
        this.positionDialogWhereTriggeringElement();
        this.positionDialogUpIfBottomOutsideViewport();
        this.visible = true;
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.registerOrUnregisterAncestrosScrollEvent(false);
    }
    /**
     * @return {?}
     */
    loadComponent() {
        /** @type {?} */
        let componentFactory = this.componentFactoryResolver.resolveComponentFactory((/** @type {?} */ (this.config.component)));
        this.popupContentViewContainer.clear();
        /** @type {?} */
        const injector = ReflectiveInjector.resolveAndCreate([
            {
                provide: MAT_DIALOG_DATA,
                useValue: this.data || {}
            },
            {
                provide: POPUP_DIALOG_CLOSE,
                useValue: this.closeDialog.bind(this)
            }
        ]);
        /** @type {?} */
        let componentRef = this.popupContentViewContainer.createComponent(componentFactory, 0, injector);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    containerTransitionEnd(event) {
        if (event.target == this.dialogContainerRef.nativeElement && !this.visible) {
            this.dialogRef.close(this.dialogResult);
        }
    }
    /**
     * @param {?=} dialogResult
     * @return {?}
     */
    closeDialog(dialogResult) {
        this.dialogResult = dialogResult;
        this.visible = false;
        this.isOpened = false;
    }
    /**
     * @private
     * @param {?=} register
     * @return {?}
     */
    registerOrUnregisterAncestrosScrollEvent(register = true) {
        /** @type {?} */
        let elem = ((/** @type {?} */ (this.config.triggeringElement))).parentNode;
        while (elem !== null) {
            register ?
                elem.addEventListener("scroll", this.scrollBoundedFunction) :
                elem.removeEventListener("scroll", this.scrollBoundedFunction);
            elem = elem.parentNode;
        }
    }
    /**
     * @private
     * @return {?}
     */
    positionDialogWhereTriggeringElement() {
        /** @type {?} */
        const matDialogConfig = new MatDialogConfig();
        /** @type {?} */
        const rect = this.config.triggeringElement.getBoundingClientRect();
        /** @type {?} */
        let top = this.config.coverTriggeringElement ?
            rect.bottom - this.config.triggeringElement.offsetHeight - 1 :
            rect.bottom;
        matDialogConfig.position = { top: `${top}px` };
        if (this.direction == 'rtl') {
            /** @type {?} */
            let right = window.innerWidth - rect.left - this.config.triggeringElement.offsetWidth;
            matDialogConfig.position.right = `${right}px`;
        }
        else {
            matDialogConfig.position.left = `${rect.left}px`;
        }
        this.dialogRef.updatePosition(matDialogConfig.position);
    }
    /**
     * @private
     * @return {?}
     */
    positionDialogUpIfBottomOutsideViewport() {
        if (!this.config.scaleToTopOnBottomOverflow)
            return;
        /** @type {?} */
        let dialogContainerElem = (/** @type {?} */ (this.dialogContainerRef.nativeElement));
        /** @type {?} */
        let result = this.isOutOfViewport();
        if (result.bottom && !result.topIfScaleToTop) {
            this.scaleBottomToTop = true;
            /** @type {?} */
            const matDialogConfig = new MatDialogConfig();
            /** @type {?} */
            const rect = dialogContainerElem.getBoundingClientRect();
            /** @type {?} */
            let triggeringElementHeight = this.config.triggeringElement.offsetHeight;
            /** @type {?} */
            let top = this.config.coverTriggeringElement ?
                rect.top - dialogContainerElem.offsetHeight + triggeringElementHeight + 1 :
                rect.top - dialogContainerElem.offsetHeight - triggeringElementHeight;
            matDialogConfig.position = { top: `${top}px` };
            if (this.direction == 'rtl') {
                /** @type {?} */
                let right = window.innerWidth - rect.left - this.config.triggeringElement.offsetWidth;
                matDialogConfig.position.right = `${right}px`;
            }
            else {
                matDialogConfig.position.left = `${rect.left}px`;
            }
            this.dialogRef.updatePosition(matDialogConfig.position);
        }
        else {
            this.scaleBottomToTop = false;
        }
    }
    /**
     * @private
     * @return {?}
     */
    isOutOfViewport() {
        /** @type {?} */
        let container = this.dialogContainerRef.nativeElement;
        /** @type {?} */
        let triggeringElement = this.config.triggeringElement;
        // Get element's bounding
        /** @type {?} */
        var bounding = container.getBoundingClientRect();
        // reduce height from top position if scale to top
        /** @type {?} */
        let top = bounding.top;
        if (this.scaleBottomToTop) {
            top = this.config.coverTriggeringElement ?
                bounding.top - container.offsetHeight + triggeringElement.offsetHeight :
                bounding.top - container.offsetHeight - triggeringElement.offsetHeight;
        }
        /** @type {?} */
        let topIfScaleToTop = top;
        if (!this.scaleBottomToTop) {
            topIfScaleToTop = top - (this.config.coverTriggeringElement ? container.offsetHeight - triggeringElement.offsetHeight : container.offsetHeight + triggeringElement.offsetHeight);
        }
        /** @type {?} */
        var out = {};
        out.top = top < 0;
        out.topIfScaleToTop = topIfScaleToTop < 0;
        out.left = bounding.left < 0;
        out.bottom = (bounding.top + container.offsetHeight) > (window.innerHeight || document.documentElement.offsetHeight);
        if (this.scaleBottomToTop && !out.bottom) {
            if (!out.top)
                out.bottom = true;
        }
        out.right = (bounding.left + container.offsetWidth) > (window.innerWidth || document.documentElement.offsetWidth);
        out.any = out.top || out.left || out.bottom || out.right;
        out.all = out.top && out.left && out.bottom && out.right;
        return out;
    }
    ;
    /**
     * @private
     * @param {?} node
     * @param {?} ancestor
     * @return {?}
     */
    childOf(node, ancestor) {
        /** @type {?} */
        var child = node;
        while (child !== null) {
            if (child === ancestor)
                return true;
            child = child.parentNode;
        }
        return false;
    }
}
PopupDialog.decorators = [
    { type: Component, args: [{
                selector: 'popup-dialog',
                template: "<div #dialogContainer [attr.dir]=\"direction == 'rtl' ? 'rtl' : ''\" (transitionend)=\"containerTransitionEnd($event)\"\n class=\"ngx-popup-dialog-container\" [ngClass]=\"{'visible': visible, 'scale-to-top': scaleBottomToTop, 'rtl': direction == 'rtl'}\"\n [style.max-width]=\"config.maxWidth\" [style.max-height]=\"config.maxHeight\">\n  <ng-template #popupContent></ng-template>\n</div>\n",
                encapsulation: ViewEncapsulation.None,
                styles: [".ngx-popup-dialog-overlay{display:block}.ngx-popup-dialog-overlay .mat-dialog-container{display:inline;padding:0}.ngx-popup-dialog-container{box-shadow:0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12),0 2px 4px -1px rgba(0,0,0,.2);background:#fff;border-radius:2px;overflow:auto;transition:transform 150ms cubic-bezier(.4,0,1,1);transition:transform 150ms cubic-bezier(.4,0,1,1),-webkit-transform 150ms cubic-bezier(.4,0,1,1);-webkit-transform-origin:top left;transform-origin:top left;-webkit-transform:scale3d(0,0,1);transform:scale3d(0,0,1)}.ngx-popup-dialog-container.rtl{-webkit-transform-origin:top right;transform-origin:top right;direction:rtl}.ngx-popup-dialog-container.visible{transition:transform 150ms cubic-bezier(0,0,.2,1);transition:transform 150ms cubic-bezier(0,0,.2,1),-webkit-transform 150ms cubic-bezier(0,0,.2,1);-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1)}.ngx-popup-dialog-container.scale-to-top{-webkit-transform-origin:left bottom 0;transform-origin:left bottom 0}.ngx-popup-dialog-container.rtl.scale-to-top{-webkit-transform-origin:right bottom 0;transform-origin:right bottom 0}.ngx-popup-dialog-container::-webkit-scrollbar{width:6px;background-color:#f5f5f5}.ngx-popup-dialog-container::-webkit-scrollbar-thumb{border-radius:10px;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#d9d9d9}"]
            }] }
];
/** @nocollapse */
PopupDialog.ctorParameters = () => [
    { type: ComponentFactoryResolver },
    { type: MatDialogRef },
    { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
];
PopupDialog.propDecorators = {
    popupContentViewContainer: [{ type: ViewChild, args: ['popupContent', { read: ViewContainerRef },] }],
    dialogContainerRef: [{ type: ViewChild, args: ['dialogContainer',] }],
    onMouseDown: [{ type: HostListener, args: ['document:mousedown', ['$event'],] }],
    onMouseUp: [{ type: HostListener, args: ['document:mouseup', ['$event'],] }],
    onClick: [{ type: HostListener, args: ['document:click', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    PopupDialog.prototype.popupContentViewContainer;
    /**
     * @type {?}
     * @protected
     */
    PopupDialog.prototype.dialogContainerRef;
    /** @type {?} */
    PopupDialog.prototype.dialogResult;
    /** @type {?} */
    PopupDialog.prototype.visible;
    /** @type {?} */
    PopupDialog.prototype.isOpened;
    /** @type {?} */
    PopupDialog.prototype.scaleBottomToTop;
    /** @type {?} */
    PopupDialog.prototype.direction;
    /** @type {?} */
    PopupDialog.prototype.config;
    /** @type {?} */
    PopupDialog.prototype.data;
    /** @type {?} */
    PopupDialog.prototype.scrollBoundedFunction;
    /** @type {?} */
    PopupDialog.prototype.lastClickedElement;
    /** @type {?} */
    PopupDialog.prototype.mouseDownHandled;
    /** @type {?} */
    PopupDialog.prototype.mouseUpHandled;
    /** @type {?} */
    PopupDialog.prototype.clickHandled;
    /**
     * @type {?}
     * @private
     */
    PopupDialog.prototype.componentFactoryResolver;
    /** @type {?} */
    PopupDialog.prototype.dialogRef;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wdXAtZGlhbG9nLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXBvcHVwLWRpYWxvZy8iLCJzb3VyY2VzIjpbImxpYi9wb3B1cC1kaWFsb2cvcG9wdXAtZGlhbG9nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQ0wsU0FBUyxFQUNULHdCQUF3QixFQUN4QixVQUFVLEVBQ1YsWUFBWSxFQUNaLE1BQU0sRUFDTixrQkFBa0IsRUFHbEIsU0FBUyxFQUNULGdCQUFnQixFQUNoQixpQkFBaUIsRUFDakIsY0FBYyxHQUNmLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLFlBQVksRUFBRSxNQUFNLDBCQUEwQixDQUFDOztBQUcxRixNQUFNLE9BQU8sa0JBQWtCLEdBQUcsSUFBSSxjQUFjLENBQThCLG9CQUFvQixDQUFDOzs7O0FBSXZHLHVDQUdDOzs7SUFGQyw4Q0FBdUI7O0lBQ3ZCLHNDQUFpRDs7Ozs7QUFHbkQscUNBR0M7OztJQUZDLGlDQUEwQjs7SUFDMUIsK0JBQVU7Ozs7O0FBR1osNEJBUUM7OztJQVBDLDRCQUFhOztJQUNiLHdDQUF5Qjs7SUFDekIsNkJBQWM7O0lBQ2QsK0JBQWdCOztJQUNoQiw4QkFBZTs7SUFDZiw0QkFBYTs7SUFDYiw0QkFBYTs7QUFTZixNQUFNLE9BQU8sV0FBVzs7Ozs7O0lBV3RCLFlBQ1Usd0JBQWtELEVBQ25ELFNBQW9DLEVBQ2xCLElBQXFCO1FBRnRDLDZCQUF3QixHQUF4Qix3QkFBd0IsQ0FBMEI7UUFDbkQsY0FBUyxHQUFULFNBQVMsQ0FBMkI7UUFUN0MsWUFBTyxHQUFHLEtBQUssQ0FBQztRQUNoQixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLHFCQUFnQixHQUFHLEtBQUssQ0FBQztRQWN6QiwwQkFBcUIsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzs7UUFTakQscUJBQWdCLEdBQUcsSUFBSSxDQUFD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YUFDdEM7Ozs7WUE1Q0Msd0JBQXdCO1lBWWlCLFlBQVk7NENBK0NsRCxNQUFNLFNBQUMsZUFBZTs7O3dDQWJ4QixTQUFTLFNBQUMsY0FBYyxFQUFFLEVBQUUsSUFBSSxFQUFFLGdCQUFnQixFQUFFO2lDQUNwRCxTQUFTLFNBQUMsaUJBQWlCOzBCQStCM0IsWUFBWSxTQUFDLG9CQUFvQixFQUFFLENBQUMsUUFBUSxDQUFDO3dCQU03QyxZQUFZLFNBQUMsa0JBQWtCLEVBQUUsQ0FBQyxRQUFRLENBQUM7c0JBWTNDLFlBQVksU0FBQyxnQkFBZ0IsRUFBRSxDQUFDLFFBQVEsQ0FBQzs7OztJQWxEMUMsZ0RBQW1HOzs7OztJQUNuRyx5Q0FBdUU7O0lBQ3ZFLG1DQUFrQjs7SUFDbEIsOEJBQWdCOztJQUNoQiwrQkFBaUI7O0lBQ2pCLHVDQUF5Qjs7SUFDekIsZ0NBQTBCOztJQUUxQiw2QkFBMEI7O0lBQzFCLDJCQUFVOztJQVVWLDRDQUFpRDs7SUFPakQseUNBQW1COztJQUVuQix1Q0FBd0I7O0lBQ3hCLHFDQUFzQjs7SUFDdEIsbUNBQW9COzs7OztJQW5CbEIsK0NBQTBEOztJQUMxRCxnQ0FBMkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnRUeXBlIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3BvcnRhbCc7XG5pbXBvcnQge1xuICBDb21wb25lbnQsXG4gIENvbXBvbmVudEZhY3RvcnlSZXNvbHZlcixcbiAgRWxlbWVudFJlZixcbiAgSG9zdExpc3RlbmVyLFxuICBJbmplY3QsXG4gIFJlZmxlY3RpdmVJbmplY3RvcixcbiAgVGVtcGxhdGVSZWYsXG4gIFR5cGUsXG4gIFZpZXdDaGlsZCxcbiAgVmlld0NvbnRhaW5lclJlZixcbiAgVmlld0VuY2Fwc3VsYXRpb24sXG4gIEluamVjdGlvblRva2VuLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE1BVF9ESUFMT0dfREFUQSwgTWF0RGlhbG9nQ29uZmlnLCBNYXREaWFsb2dSZWYgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgUG9wdXBEaWFsb2dTZXJ2aWNlQ29uZmlnIH0gZnJvbSAnLi9wb3B1cC1kaWFsb2cuc2VydmljZSc7XG5cbmV4cG9ydCBjb25zdCBQT1BVUF9ESUFMT0dfQ0xPU0UgPSBuZXcgSW5qZWN0aW9uVG9rZW48KGRpYWxvZ1Jlc3VsdDogYW55KSA9PiB2b2lkPignUE9QVVBfRElBTE9HX0NMT1NFJyk7XG5cbmV4cG9ydCBkZWNsYXJlIHR5cGUgRGlyZWN0aW9uID0gJ2x0cicgfCAncnRsJztcblxuZXhwb3J0IGludGVyZmFjZSBQb3B1cERpYWxvZ0NvbmZpZyBleHRlbmRzIFBvcHVwRGlhbG9nU2VydmljZUNvbmZpZyB7XG4gIHRyaWdnZXJpbmdFbGVtZW50OiBhbnk7XG4gIGNvbXBvbmVudDogQ29tcG9uZW50VHlwZTxhbnk+IHwgVGVtcGxhdGVSZWY8YW55Pjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQb3B1cERpYWxvZ0RhdGEge1xuICBjb25maWc6IFBvcHVwRGlhbG9nQ29uZmlnO1xuICBkYXRhOiBhbnk7XG59XG5cbmludGVyZmFjZSBPdXRPZlZpZXdwb3J0IHtcbiAgdG9wOiBib29sZWFuO1xuICB0b3BJZlNjYWxlVG9Ub3A6IGJvb2xlYW47XG4gIGxlZnQ6IGJvb2xlYW47XG4gIGJvdHRvbTogYm9vbGVhbjtcbiAgcmlnaHQ6IGJvb2xlYW47XG4gIGFueTogYm9vbGVhbjtcbiAgYWxsOiBib29sZWFuO1xufVxuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdwb3B1cC1kaWFsb2cnLFxuICB0ZW1wbGF0ZVVybDogJ3BvcHVwLWRpYWxvZy5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJ3BvcHVwLWRpYWxvZy5jc3MnXSxcbiAgZW5jYXBzdWxhdGlvbjogVmlld0VuY2Fwc3VsYXRpb24uTm9uZVxufSlcbmV4cG9ydCBjbGFzcyBQb3B1cERpYWxvZyB7XG4gIEBWaWV3Q2hpbGQoJ3BvcHVwQ29udGVudCcsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiB9KSBwb3B1cENvbnRlbnRWaWV3Q29udGFpbmVyOiBWaWV3Q29udGFpbmVyUmVmO1xuICBAVmlld0NoaWxkKCdkaWFsb2dDb250YWluZXInKSBwcm90ZWN0ZWQgZGlhbG9nQ29udGFpbmVyUmVmOiBFbGVtZW50UmVmO1xuICBkaWFsb2dSZXN1bHQ6IGFueTtcbiAgdmlzaWJsZSA9IGZhbHNlO1xuICBpc09wZW5lZCA9IGZhbHNlO1xuICBzY2FsZUJvdHRvbVRvVG9wID0gZmFsc2U7XG4gIGRpcmVjdGlvbj86ICdsdHInIHwgJ3J0bCc7XG5cbiAgY29uZmlnOiBQb3B1cERpYWxvZ0NvbmZpZztcbiAgZGF0YTogYW55O1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGNvbXBvbmVudEZhY3RvcnlSZXNvbHZlcjogQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICAgIHB1YmxpYyBkaWFsb2dSZWY6IE1hdERpYWxvZ1JlZjxQb3B1cERpYWxvZz4sXG4gICAgQEluamVjdChNQVRfRElBTE9HX0RBVEEpIGRhdGE6IFBvcHVwRGlhbG9nRGF0YSkge1xuICAgIHRoaXMuY29uZmlnID0gZGF0YS5jb25maWc7XG4gICAgdGhpcy5kYXRhID0gZGF0YS5kYXRhO1xuICAgIHRoaXMuZGlyZWN0aW9uID0gZGF0YS5jb25maWcuZGlyZWN0aW9uIHx8IGdldENvbXB1dGVkU3R5bGUodGhpcy5jb25maWcudHJpZ2dlcmluZ0VsZW1lbnQpLmRpcmVjdGlvbiBhcyAoJ2x0cicgfCAncnRsJylcbiAgfVxuXG4gIHNjcm9sbEJvdW5kZWRGdW5jdGlvbiA9IHRoaXMub25TY3JvbGwuYmluZCh0aGlzKTtcblxuICBvblNjcm9sbChldmVudCkge1xuICAgIHRoaXMucG9zaXRpb25EaWFsb2dXaGVyZVRyaWdnZXJpbmdFbGVtZW50KCk7XG4gICAgdGhpcy5wb3NpdGlvbkRpYWxvZ1VwSWZCb3R0b21PdXRzaWRlVmlld3BvcnQoKTtcbiAgfVxuXG4gIGxhc3RDbGlja2VkRWxlbWVudDtcbiAgLy8gc2V0IGV2ZW50cyBoYW5kbGVkIHRvIHRydWUgdG8gaWdub3JlIGV2ZW50IHdoZW4gcG9wdXAgb3BlbmVkIGZvciB0aGUgZmlyc3QgdGltZS5cbiAgbW91c2VEb3duSGFuZGxlZCA9IHRydWU7XG4gIG1vdXNlVXBIYW5kbGVkID0gdHJ1ZTtcbiAgY2xpY2tIYW5kbGVkID0gdHJ1ZTtcblxuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDptb3VzZWRvd24nLCBbJyRldmVudCddKVxuICBvbk1vdXNlRG93bihldmVudDogRXZlbnQpIHtcbiAgICB0aGlzLmhhbmRsZU1vdXNlRXZlbnQoZXZlbnQpO1xuICAgIHRoaXMubW91c2VEb3duSGFuZGxlZCA9IHRydWU7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDptb3VzZXVwJywgWyckZXZlbnQnXSlcbiAgb25Nb3VzZVVwKGV2ZW50OiBFdmVudCkge1xuICAgIGlmICh0aGlzLm1vdXNlRG93bkhhbmRsZWQgfHwgdGhpcy5jbGlja0hhbmRsZWQpIHtcbiAgICAgIHRoaXMubW91c2VEb3duSGFuZGxlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5jbGlja0hhbmRsZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmhhbmRsZU1vdXNlRXZlbnQoZXZlbnQpO1xuICAgIHRoaXMubW91c2VVcEhhbmRsZWQgPSB0cnVlO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6Y2xpY2snLCBbJyRldmVudCddKVxuICBvbkNsaWNrKGV2ZW50OiBFdmVudCkge1xuICAgIGlmICh0aGlzLm1vdXNlRG93bkhhbmRsZWQgfHwgdGhpcy5tb3VzZVVwSGFuZGxlZCkge1xuICAgICAgdGhpcy5tb3VzZURvd25IYW5kbGVkID0gZmFsc2U7XG4gICAgICB0aGlzLm1vdXNlVXBIYW5kbGVkID0gZmFsc2U7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5oYW5kbGVNb3VzZUV2ZW50KGV2ZW50KTtcbiAgICB0aGlzLmNsaWNrSGFuZGxlZCA9IHRydWU7XG4gIH1cblxuICBoYW5kbGVNb3VzZUV2ZW50KGV2ZW50OiBFdmVudCkge1xuICAgIGlmICghdGhpcy5pc09wZW5lZCkgcmV0dXJuO1xuXG4gICAgLy8gQ2xpY2tpbmcgb24gZWxlbWVudCB3aWxsIHRyaWdnZXIgdGhpcyBjYWxsYmFjayBmdW5jdGlvbiBtdWx0aXBsZSB0aW1lcyAoZm9yIG1vdXNlIGRvd24sIHVwIGFuZCBjbGljaylcbiAgICAvLyBUaGVyZWZvciwgd2Ugc3RvcCBleGVjdXRpb24gaWYgd2UgZ2V0IHRoZSBzYW1lIGV2ZW50IHRhcmdldC5cbiAgICAvLyBXZSByZXNldCB0aGUgbGFzdENsaWNrZWRFbGVtZW50IGFmdGVyIDEwMCBtc1xuICAgIGlmICh0aGlzLmxhc3RDbGlja2VkRWxlbWVudCA9PSBldmVudC50YXJnZXQpIHJldHVybjtcbiAgICB0aGlzLmxhc3RDbGlja2VkRWxlbWVudCA9IGV2ZW50LnRhcmdldDtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMubGFzdENsaWNrZWRFbGVtZW50ID0gbnVsbDtcbiAgICB9LCAyMDApO1xuXG4gICAgdmFyIGNvbnRhaW5lciA9IHRoaXMuZGlhbG9nQ29udGFpbmVyUmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgaWYgKGNvbnRhaW5lciA9PT0gZXZlbnQudGFyZ2V0IHx8IHRoaXMuY2hpbGRPZihldmVudC50YXJnZXQsIGNvbnRhaW5lcikpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHRoaXMuY29uZmlnLnN1cHByZXNzQ2xvc2VPbkNsaWNrU2VsZWN0b3JzKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuY29uZmlnLnN1cHByZXNzQ2xvc2VPbkNsaWNrU2VsZWN0b3JzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHNlbGVjdG9yID0gdGhpcy5jb25maWcuc3VwcHJlc3NDbG9zZU9uQ2xpY2tTZWxlY3RvcnNbaV07XG4gICAgICAgIGNvbnN0IGVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3Rvcik7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBjb25zdCBlbGVtID0gZWxlbWVudHNbaV07XG4gICAgICAgICAgaWYgKGVsZW0gPT09IGV2ZW50LnRhcmdldCB8fCB0aGlzLmNoaWxkT2YoZXZlbnQudGFyZ2V0LCBlbGVtKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuY2xvc2VEaWFsb2coKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMucmVnaXN0ZXJPclVucmVnaXN0ZXJBbmNlc3Ryb3NTY3JvbGxFdmVudCgpO1xuICAgIHRoaXMubG9hZENvbXBvbmVudCgpO1xuICAgIHRoaXMuZGlhbG9nUmVmLmJlZm9yZUNsb3NlKCkuc3Vic2NyaWJlKHggPT4ge1xuICAgICAgdGhpcy52aXNpYmxlID0gZmFsc2U7XG4gICAgICB0aGlzLmlzT3BlbmVkID0gZmFsc2U7XG4gICAgfSlcbiAgICB0aGlzLmRpYWxvZ1JlZi5hZnRlck9wZW4oKS5zdWJzY3JpYmUoeCA9PiB7XG4gICAgICB0aGlzLmlzT3BlbmVkID0gdHJ1ZTtcbiAgICB9KVxuICAgIHRoaXMucG9zaXRpb25EaWFsb2dXaGVyZVRyaWdnZXJpbmdFbGVtZW50KCk7XG4gICAgdGhpcy5wb3NpdGlvbkRpYWxvZ1VwSWZCb3R0b21PdXRzaWRlVmlld3BvcnQoKTtcbiAgICB0aGlzLnZpc2libGUgPSB0cnVlO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5yZWdpc3Rlck9yVW5yZWdpc3RlckFuY2VzdHJvc1Njcm9sbEV2ZW50KGZhbHNlKTtcbiAgfVxuXG4gIGxvYWRDb21wb25lbnQoKSB7XG4gICAgbGV0IGNvbXBvbmVudEZhY3RvcnkgPSB0aGlzLmNvbXBvbmVudEZhY3RvcnlSZXNvbHZlci5yZXNvbHZlQ29tcG9uZW50RmFjdG9yeSh0aGlzLmNvbmZpZy5jb21wb25lbnQgYXMgVHlwZTxhbnk+KTtcblxuICAgIHRoaXMucG9wdXBDb250ZW50Vmlld0NvbnRhaW5lci5jbGVhcigpO1xuXG4gICAgY29uc3QgaW5qZWN0b3IgPSBSZWZsZWN0aXZlSW5qZWN0b3IucmVzb2x2ZUFuZENyZWF0ZShbXG4gICAgICB7XG4gICAgICAgIHByb3ZpZGU6IE1BVF9ESUFMT0dfREFUQSxcbiAgICAgICAgdXNlVmFsdWU6IHRoaXMuZGF0YSB8fCB7fVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgcHJvdmlkZTogUE9QVVBfRElBTE9HX0NMT1NFLFxuICAgICAgICB1c2VWYWx1ZTogdGhpcy5jbG9zZURpYWxvZy5iaW5kKHRoaXMpXG4gICAgICB9XG4gICAgXSk7XG4gICAgbGV0IGNvbXBvbmVudFJlZiA9IHRoaXMucG9wdXBDb250ZW50Vmlld0NvbnRhaW5lci5jcmVhdGVDb21wb25lbnQoY29tcG9uZW50RmFjdG9yeSwgMCwgaW5qZWN0b3IpO1xuICB9XG5cbiAgY29udGFpbmVyVHJhbnNpdGlvbkVuZChldmVudDogRXZlbnQpIHtcbiAgICBpZiAoZXZlbnQudGFyZ2V0ID09IHRoaXMuZGlhbG9nQ29udGFpbmVyUmVmLm5hdGl2ZUVsZW1lbnQgJiYgIXRoaXMudmlzaWJsZSkge1xuICAgICAgdGhpcy5kaWFsb2dSZWYuY2xvc2UodGhpcy5kaWFsb2dSZXN1bHQpO1xuICAgIH1cbiAgfVxuXG4gIGNsb3NlRGlhbG9nKGRpYWxvZ1Jlc3VsdD86IGFueSkge1xuICAgIHRoaXMuZGlhbG9nUmVzdWx0ID0gZGlhbG9nUmVzdWx0O1xuICAgIHRoaXMudmlzaWJsZSA9IGZhbHNlO1xuICAgIHRoaXMuaXNPcGVuZWQgPSBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgcmVnaXN0ZXJPclVucmVnaXN0ZXJBbmNlc3Ryb3NTY3JvbGxFdmVudChyZWdpc3RlciA9IHRydWUpIHtcbiAgICBsZXQgZWxlbSA9ICh0aGlzLmNvbmZpZy50cmlnZ2VyaW5nRWxlbWVudCBhcyBOb2RlKS5wYXJlbnROb2RlO1xuICAgIHdoaWxlIChlbGVtICE9PSBudWxsKSB7XG4gICAgICByZWdpc3RlciA/XG4gICAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCB0aGlzLnNjcm9sbEJvdW5kZWRGdW5jdGlvbikgOlxuICAgICAgICBlbGVtLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgdGhpcy5zY3JvbGxCb3VuZGVkRnVuY3Rpb24pO1xuICAgICAgZWxlbSA9IGVsZW0ucGFyZW50Tm9kZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHBvc2l0aW9uRGlhbG9nV2hlcmVUcmlnZ2VyaW5nRWxlbWVudCgpIHtcbiAgICBjb25zdCBtYXREaWFsb2dDb25maWc6IE1hdERpYWxvZ0NvbmZpZyA9IG5ldyBNYXREaWFsb2dDb25maWcoKTtcbiAgICBjb25zdCByZWN0ID0gdGhpcy5jb25maWcudHJpZ2dlcmluZ0VsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgbGV0IHRvcCA9IHRoaXMuY29uZmlnLmNvdmVyVHJpZ2dlcmluZ0VsZW1lbnQgP1xuICAgICAgcmVjdC5ib3R0b20gLSB0aGlzLmNvbmZpZy50cmlnZ2VyaW5nRWxlbWVudC5vZmZzZXRIZWlnaHQgLSAxIDpcbiAgICAgIHJlY3QuYm90dG9tXG5cbiAgICBtYXREaWFsb2dDb25maWcucG9zaXRpb24gPSB7IHRvcDogYCR7dG9wfXB4YCB9O1xuICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAncnRsJykge1xuICAgICAgbGV0IHJpZ2h0ID0gd2luZG93LmlubmVyV2lkdGggLSByZWN0LmxlZnQgLSB0aGlzLmNvbmZpZy50cmlnZ2VyaW5nRWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICAgIG1hdERpYWxvZ0NvbmZpZy5wb3NpdGlvbi5yaWdodCA9IGAke3JpZ2h0fXB4YDtcbiAgICB9IGVsc2Uge1xuICAgICAgbWF0RGlhbG9nQ29uZmlnLnBvc2l0aW9uLmxlZnQgPSBgJHtyZWN0LmxlZnR9cHhgO1xuICAgIH1cblxuICAgIHRoaXMuZGlhbG9nUmVmLnVwZGF0ZVBvc2l0aW9uKG1hdERpYWxvZ0NvbmZpZy5wb3NpdGlvbik7XG4gIH1cblxuICBwcml2YXRlIHBvc2l0aW9uRGlhbG9nVXBJZkJvdHRvbU91dHNpZGVWaWV3cG9ydCgpIHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLnNjYWxlVG9Ub3BPbkJvdHRvbU92ZXJmbG93KSByZXR1cm47XG5cbiAgICBsZXQgZGlhbG9nQ29udGFpbmVyRWxlbSA9IHRoaXMuZGlhbG9nQ29udGFpbmVyUmVmLm5hdGl2ZUVsZW1lbnQgYXMgSFRNTEVsZW1lbnQ7XG4gICAgbGV0IHJlc3VsdCA9IHRoaXMuaXNPdXRPZlZpZXdwb3J0KCk7XG5cbiAgICBpZiAocmVzdWx0LmJvdHRvbSAmJiAhcmVzdWx0LnRvcElmU2NhbGVUb1RvcCkge1xuICAgICAgdGhpcy5zY2FsZUJvdHRvbVRvVG9wID0gdHJ1ZTtcbiAgICAgIGNvbnN0IG1hdERpYWxvZ0NvbmZpZzogTWF0RGlhbG9nQ29uZmlnID0gbmV3IE1hdERpYWxvZ0NvbmZpZygpO1xuICAgICAgY29uc3QgcmVjdCA9IGRpYWxvZ0NvbnRhaW5lckVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgICBsZXQgdHJpZ2dlcmluZ0VsZW1lbnRIZWlnaHQgPSB0aGlzLmNvbmZpZy50cmlnZ2VyaW5nRWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgICBsZXQgdG9wID0gdGhpcy5jb25maWcuY292ZXJUcmlnZ2VyaW5nRWxlbWVudCA/XG4gICAgICAgIHJlY3QudG9wIC0gZGlhbG9nQ29udGFpbmVyRWxlbS5vZmZzZXRIZWlnaHQgKyB0cmlnZ2VyaW5nRWxlbWVudEhlaWdodCArIDEgOlxuICAgICAgICByZWN0LnRvcCAtIGRpYWxvZ0NvbnRhaW5lckVsZW0ub2Zmc2V0SGVpZ2h0IC0gdHJpZ2dlcmluZ0VsZW1lbnRIZWlnaHRcblxuICAgICAgbWF0RGlhbG9nQ29uZmlnLnBvc2l0aW9uID0geyB0b3A6IGAke3RvcH1weGAgfTtcbiAgICAgIGlmICh0aGlzLmRpcmVjdGlvbiA9PSAncnRsJykge1xuICAgICAgICBsZXQgcmlnaHQgPSB3aW5kb3cuaW5uZXJXaWR0aCAtIHJlY3QubGVmdCAtIHRoaXMuY29uZmlnLnRyaWdnZXJpbmdFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgICBtYXREaWFsb2dDb25maWcucG9zaXRpb24ucmlnaHQgPSBgJHtyaWdodH1weGA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBtYXREaWFsb2dDb25maWcucG9zaXRpb24ubGVmdCA9IGAke3JlY3QubGVmdH1weGA7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuZGlhbG9nUmVmLnVwZGF0ZVBvc2l0aW9uKG1hdERpYWxvZ0NvbmZpZy5wb3NpdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2NhbGVCb3R0b21Ub1RvcCA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaXNPdXRPZlZpZXdwb3J0KCk6IE91dE9mVmlld3BvcnQge1xuICAgIGxldCBjb250YWluZXIgPSB0aGlzLmRpYWxvZ0NvbnRhaW5lclJlZi5uYXRpdmVFbGVtZW50O1xuICAgIGxldCB0cmlnZ2VyaW5nRWxlbWVudCA9IHRoaXMuY29uZmlnLnRyaWdnZXJpbmdFbGVtZW50O1xuICAgIC8vIEdldCBlbGVtZW50J3MgYm91bmRpbmdcbiAgICB2YXIgYm91bmRpbmcgPSBjb250YWluZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG5cbiAgICAvLyByZWR1Y2UgaGVpZ2h0IGZyb20gdG9wIHBvc2l0aW9uIGlmIHNjYWxlIHRvIHRvcFxuICAgIGxldCB0b3AgPSBib3VuZGluZy50b3A7XG4gICAgaWYgKHRoaXMuc2NhbGVCb3R0b21Ub1RvcCkge1xuICAgICAgdG9wID0gdGhpcy5jb25maWcuY292ZXJUcmlnZ2VyaW5nRWxlbWVudCA/XG4gICAgICAgIGJvdW5kaW5nLnRvcCAtIGNvbnRhaW5lci5vZmZzZXRIZWlnaHQgKyB0cmlnZ2VyaW5nRWxlbWVudC5vZmZzZXRIZWlnaHQgOlxuICAgICAgICBib3VuZGluZy50b3AgLSBjb250YWluZXIub2Zmc2V0SGVpZ2h0IC0gdHJpZ2dlcmluZ0VsZW1lbnQub2Zmc2V0SGVpZ2h0XG4gICAgfVxuXG4gICAgbGV0IHRvcElmU2NhbGVUb1RvcCA9IHRvcDtcbiAgICBpZiAoIXRoaXMuc2NhbGVCb3R0b21Ub1RvcCkge1xuICAgICAgdG9wSWZTY2FsZVRvVG9wID0gdG9wIC0gKHRoaXMuY29uZmlnLmNvdmVyVHJpZ2dlcmluZ0VsZW1lbnQgPyBjb250YWluZXIub2Zmc2V0SGVpZ2h0IC0gdHJpZ2dlcmluZ0VsZW1lbnQub2Zmc2V0SGVpZ2h0IDogY29udGFpbmVyLm9mZnNldEhlaWdodCArIHRyaWdnZXJpbmdFbGVtZW50Lm9mZnNldEhlaWdodCk7XG4gICAgfVxuXG4gICAgdmFyIG91dDogYW55ID0ge307XG4gICAgb3V0LnRvcCA9IHRvcCA8IDA7XG4gICAgb3V0LnRvcElmU2NhbGVUb1RvcCA9IHRvcElmU2NhbGVUb1RvcCA8IDA7XG4gICAgb3V0LmxlZnQgPSBib3VuZGluZy5sZWZ0IDwgMDtcbiAgICBvdXQuYm90dG9tID0gKGJvdW5kaW5nLnRvcCArIGNvbnRhaW5lci5vZmZzZXRIZWlnaHQpID4gKHdpbmRvdy5pbm5lckhlaWdodCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0KTtcbiAgICBpZiAodGhpcy5zY2FsZUJvdHRvbVRvVG9wICYmICFvdXQuYm90dG9tKSB7XG4gICAgICBpZiAoIW91dC50b3ApIG91dC5ib3R0b20gPSB0cnVlO1xuICAgIH1cbiAgICBvdXQucmlnaHQgPSAoYm91bmRpbmcubGVmdCArIGNvbnRhaW5lci5vZmZzZXRXaWR0aCkgPiAod2luZG93LmlubmVyV2lkdGggfHwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldFdpZHRoKTtcbiAgICBvdXQuYW55ID0gb3V0LnRvcCB8fCBvdXQubGVmdCB8fCBvdXQuYm90dG9tIHx8IG91dC5yaWdodDtcbiAgICBvdXQuYWxsID0gb3V0LnRvcCAmJiBvdXQubGVmdCAmJiBvdXQuYm90dG9tICYmIG91dC5yaWdodDtcblxuICAgIHJldHVybiBvdXQ7XG4gIH07XG5cbiAgcHJpdmF0ZSBjaGlsZE9mKG5vZGUsIGFuY2VzdG9yKSB7XG4gICAgdmFyIGNoaWxkID0gbm9kZTtcbiAgICB3aGlsZSAoY2hpbGQgIT09IG51bGwpIHtcbiAgICAgIGlmIChjaGlsZCA9PT0gYW5jZXN0b3IpIHJldHVybiB0cnVlO1xuICAgICAgY2hpbGQgPSBjaGlsZC5wYXJlbnROb2RlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxufVxuIl19