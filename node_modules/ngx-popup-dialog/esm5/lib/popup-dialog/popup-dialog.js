/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ComponentFactoryResolver, ElementRef, HostListener, Inject, ReflectiveInjector, ViewChild, ViewContainerRef, ViewEncapsulation, InjectionToken, } from '@angular/core';
import { MAT_DIALOG_DATA, MatDialogConfig, MatDialogRef } from '@angular/material/dialog';
/** @type {?} */
export var POPUP_DIALOG_CLOSE = new InjectionToken('POPUP_DIALOG_CLOSE');
/**
 * @record
 */
export function PopupDialogConfig() { }
if (false) {
    /** @type {?} */
    PopupDialogConfig.prototype.triggeringElement;
    /** @type {?} */
    PopupDialogConfig.prototype.component;
}
/**
 * @record
 */
export function PopupDialogData() { }
if (false) {
    /** @type {?} */
    PopupDialogData.prototype.config;
    /** @type {?} */
    PopupDialogData.prototype.data;
}
/**
 * @record
 */
function OutOfViewport() { }
if (false) {
    /** @type {?} */
    OutOfViewport.prototype.top;
    /** @type {?} */
    OutOfViewport.prototype.topIfScaleToTop;
    /** @type {?} */
    OutOfViewport.prototype.left;
    /** @type {?} */
    OutOfViewport.prototype.bottom;
    /** @type {?} */
    OutOfViewport.prototype.right;
    /** @type {?} */
    OutOfViewport.prototype.any;
    /** @type {?} */
    OutOfViewport.prototype.all;
}
var PopupDialog = /** @class */ (function () {
    function PopupDialog(componentFactoryResolver, dialogRef, data) {
        this.componentFactoryResolver = componentFactoryResolver;
        this.dialogRef = dialogRef;
        this.visible = false;
        this.isOpened = false;
        this.scaleBottomToTop = false;
        this.scrollBoundedFunction = this.onScroll.bind(this);
        // set events handled to true to ignore event when popup opened for the first time.
        this.mouseDownHandled = true;
        this.mouseUpHandled = true;
        this.clickHandled = true;
        this.config = data.config;
        this.data = data.data;
        this.direction = data.config.direction || (/** @type {?} */ (getComputedStyle(this.config.triggeringElement).direction));
    }
    /**
     * @param {?} event
     * @return {?}
     */
    PopupDialog.prototype.onScroll = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.positionDialogWhereTriggeringElement();
        this.positionDialogUpIfBottomOutsideViewport();
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PopupDialog.prototype.onMouseDown = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this.handleMouseEvent(event);
        this.mouseDownHandled = true;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PopupDialog.prototype.onMouseUp = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.mouseDownHandled || this.clickHandled) {
            this.mouseDownHandled = false;
            this.clickHandled = false;
            return;
        }
        this.handleMouseEvent(event);
        this.mouseUpHandled = true;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PopupDialog.prototype.onClick = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (this.mouseDownHandled || this.mouseUpHandled) {
            this.mouseDownHandled = false;
            this.mouseUpHandled = false;
            return;
        }
        this.handleMouseEvent(event);
        this.clickHandled = true;
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PopupDialog.prototype.handleMouseEvent = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        var _this = this;
        if (!this.isOpened)
            return;
        // Clicking on element will trigger this callback function multiple times (for mouse down, up and click)
        // Therefor, we stop execution if we get the same event target.
        // We reset the lastClickedElement after 100 ms
        if (this.lastClickedElement == event.target)
            return;
        this.lastClickedElement = event.target;
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.lastClickedElement = null;
        }), 200);
        /** @type {?} */
        var container = this.dialogContainerRef.nativeElement;
        if (container === event.target || this.childOf(event.target, container)) {
            return;
        }
        if (this.config.suppressCloseOnClickSelectors) {
            for (var i = 0; i < this.config.suppressCloseOnClickSelectors.length; i++) {
                /** @type {?} */
                var selector = this.config.suppressCloseOnClickSelectors[i];
                /** @type {?} */
                var elements = document.querySelectorAll(selector);
                for (var i_1 = 0; i_1 < elements.length; i_1++) {
                    /** @type {?} */
                    var elem = elements[i_1];
                    if (elem === event.target || this.childOf(event.target, elem)) {
                        return;
                    }
                }
            }
        }
        this.closeDialog();
    };
    /**
     * @return {?}
     */
    PopupDialog.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.registerOrUnregisterAncestrosScrollEvent();
        this.loadComponent();
        this.dialogRef.beforeClose().subscribe((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            _this.visible = false;
            _this.isOpened = false;
        }));
        this.dialogRef.afterOpen().subscribe((/**
         * @param {?} x
         * @return {?}
         */
        function (x) {
            _this.isOpened = true;
        }));
        this.positionDialogWhereTriggeringElement();
        this.positionDialogUpIfBottomOutsideViewport();
        this.visible = true;
    };
    /**
     * @return {?}
     */
    PopupDialog.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.registerOrUnregisterAncestrosScrollEvent(false);
    };
    /**
     * @return {?}
     */
    PopupDialog.prototype.loadComponent = /**
     * @return {?}
     */
    function () {
        /** @type {?} */
        var componentFactory = this.componentFactoryResolver.resolveComponentFactory((/** @type {?} */ (this.config.component)));
        this.popupContentViewContainer.clear();
        /** @type {?} */
        var injector = ReflectiveInjector.resolveAndCreate([
            {
                provide: MAT_DIALOG_DATA,
                useValue: this.data || {}
            },
            {
                provide: POPUP_DIALOG_CLOSE,
                useValue: this.closeDialog.bind(this)
            }
        ]);
        /** @type {?} */
        var componentRef = this.popupContentViewContainer.createComponent(componentFactory, 0, injector);
    };
    /**
     * @param {?} event
     * @return {?}
     */
    PopupDialog.prototype.containerTransitionEnd = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event.target == this.dialogContainerRef.nativeElement && !this.visible) {
            this.dialogRef.close(this.dialogResult);
        }
    };
    /**
     * @param {?=} dialogResult
     * @return {?}
     */
    PopupDialog.prototype.closeDialog = /**
     * @param {?=} dialogResult
     * @return {?}
     */
    function (dialogResult) {
        this.dialogResult = dialogResult;
        this.visible = false;
        this.isOpened = false;
    };
    /**
     * @private
     * @param {?=} register
     * @return {?}
     */
    PopupDialog.prototype.registerOrUnregisterAncestrosScrollEvent = /**
     * @private
     * @param {?=} register
     * @return {?}
     */
    function (register) {
        if (register === void 0) { register = true; }
        /** @type {?} */
        var elem = ((/** @type {?} */ (this.config.triggeringElement))).parentNode;
        while (elem !== null) {
            register ?
                elem.addEventListener("scroll", this.scrollBoundedFunction) :
                elem.removeEventListener("scroll", this.scrollBoundedFunction);
            elem = elem.parentNode;
        }
    };
    /**
     * @private
     * @return {?}
     */
    PopupDialog.prototype.positionDialogWhereTriggeringElement = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var matDialogConfig = new MatDialogConfig();
        /** @type {?} */
        var rect = this.config.triggeringElement.getBoundingClientRect();
        /** @type {?} */
        var top = this.config.coverTriggeringElement ?
            rect.bottom - this.config.triggeringElement.offsetHeight - 1 :
            rect.bottom;
        matDialogConfig.position = { top: top + "px" };
        if (this.direction == 'rtl') {
            /** @type {?} */
            var right = window.innerWidth - rect.left - this.config.triggeringElement.offsetWidth;
            matDialogConfig.position.right = right + "px";
        }
        else {
            matDialogConfig.position.left = rect.left + "px";
        }
        this.dialogRef.updatePosition(matDialogConfig.position);
    };
    /**
     * @private
     * @return {?}
     */
    PopupDialog.prototype.positionDialogUpIfBottomOutsideViewport = /**
     * @private
     * @return {?}
     */
    function () {
        if (!this.config.scaleToTopOnBottomOverflow)
            return;
        /** @type {?} */
        var dialogContainerElem = (/** @type {?} */ (this.dialogContainerRef.nativeElement));
        /** @type {?} */
        var result = this.isOutOfViewport();
        if (result.bottom && !result.topIfScaleToTop) {
            this.scaleBottomToTop = true;
            /** @type {?} */
            var matDialogConfig = new MatDialogConfig();
            /** @type {?} */
            var rect = dialogContainerElem.getBoundingClientRect();
            /** @type {?} */
            var triggeringElementHeight = this.config.triggeringElement.offsetHeight;
            /** @type {?} */
            var top_1 = this.config.coverTriggeringElement ?
                rect.top - dialogContainerElem.offsetHeight + triggeringElementHeight + 1 :
                rect.top - dialogContainerElem.offsetHeight - triggeringElementHeight;
            matDialogConfig.position = { top: top_1 + "px" };
            if (this.direction == 'rtl') {
                /** @type {?} */
                var right = window.innerWidth - rect.left - this.config.triggeringElement.offsetWidth;
                matDialogConfig.position.right = right + "px";
            }
            else {
                matDialogConfig.position.left = rect.left + "px";
            }
            this.dialogRef.updatePosition(matDialogConfig.position);
        }
        else {
            this.scaleBottomToTop = false;
        }
    };
    /**
     * @private
     * @return {?}
     */
    PopupDialog.prototype.isOutOfViewport = /**
     * @private
     * @return {?}
     */
    function () {
        /** @type {?} */
        var container = this.dialogContainerRef.nativeElement;
        /** @type {?} */
        var triggeringElement = this.config.triggeringElement;
        // Get element's bounding
        /** @type {?} */
        var bounding = container.getBoundingClientRect();
        // reduce height from top position if scale to top
        /** @type {?} */
        var top = bounding.top;
        if (this.scaleBottomToTop) {
            top = this.config.coverTriggeringElement ?
                bounding.top - container.offsetHeight + triggeringElement.offsetHeight :
                bounding.top - container.offsetHeight - triggeringElement.offsetHeight;
        }
        /** @type {?} */
        var topIfScaleToTop = top;
        if (!this.scaleBottomToTop) {
            topIfScaleToTop = top - (this.config.coverTriggeringElement ? container.offsetHeight - triggeringElement.offsetHeight : container.offsetHeight + triggeringElement.offsetHeight);
        }
        /** @type {?} */
        var out = {};
        out.top = top < 0;
        out.topIfScaleToTop = topIfScaleToTop < 0;
        out.left = bounding.left < 0;
        out.bottom = (bounding.top + container.offsetHeight) > (window.innerHeight || document.documentElement.offsetHeight);
        if (this.scaleBottomToTop && !out.bottom) {
            if (!out.top)
                out.bottom = true;
        }
        out.right = (bounding.left + container.offsetWidth) > (window.innerWidth || document.documentElement.offsetWidth);
        out.any = out.top || out.left || out.bottom || out.right;
        out.all = out.top && out.left && out.bottom && out.right;
        return out;
    };
    ;
    /**
     * @private
     * @param {?} node
     * @param {?} ancestor
     * @return {?}
     */
    PopupDialog.prototype.childOf = /**
     * @private
     * @param {?} node
     * @param {?} ancestor
     * @return {?}
     */
    function (node, ancestor) {
        /** @type {?} */
        var child = node;
        while (child !== null) {
            if (child === ancestor)
                return true;
            child = child.parentNode;
        }
        return false;
    };
    PopupDialog.decorators = [
        { type: Component, args: [{
                    selector: 'popup-dialog',
                    template: "<div #dialogContainer [attr.dir]=\"direction == 'rtl' ? 'rtl' : ''\" (transitionend)=\"containerTransitionEnd($event)\"\n class=\"ngx-popup-dialog-container\" [ngClass]=\"{'visible': visible, 'scale-to-top': scaleBottomToTop, 'rtl': direction == 'rtl'}\"\n [style.max-width]=\"config.maxWidth\" [style.max-height]=\"config.maxHeight\">\n  <ng-template #popupContent></ng-template>\n</div>\n",
                    encapsulation: ViewEncapsulation.None,
                    styles: [".ngx-popup-dialog-overlay{display:block}.ngx-popup-dialog-overlay .mat-dialog-container{display:inline;padding:0}.ngx-popup-dialog-container{box-shadow:0 4px 5px 0 rgba(0,0,0,.14),0 1px 10px 0 rgba(0,0,0,.12),0 2px 4px -1px rgba(0,0,0,.2);background:#fff;border-radius:2px;overflow:auto;transition:transform 150ms cubic-bezier(.4,0,1,1);transition:transform 150ms cubic-bezier(.4,0,1,1),-webkit-transform 150ms cubic-bezier(.4,0,1,1);-webkit-transform-origin:top left;transform-origin:top left;-webkit-transform:scale3d(0,0,1);transform:scale3d(0,0,1)}.ngx-popup-dialog-container.rtl{-webkit-transform-origin:top right;transform-origin:top right;direction:rtl}.ngx-popup-dialog-container.visible{transition:transform 150ms cubic-bezier(0,0,.2,1);transition:transform 150ms cubic-bezier(0,0,.2,1),-webkit-transform 150ms cubic-bezier(0,0,.2,1);-webkit-transform:scale3d(1,1,1);transform:scale3d(1,1,1)}.ngx-popup-dialog-container.scale-to-top{-webkit-transform-origin:left bottom 0;transform-origin:left bottom 0}.ngx-popup-dialog-container.rtl.scale-to-top{-webkit-transform-origin:right bottom 0;transform-origin:right bottom 0}.ngx-popup-dialog-container::-webkit-scrollbar{width:6px;background-color:#f5f5f5}.ngx-popup-dialog-container::-webkit-scrollbar-thumb{border-radius:10px;-webkit-box-shadow:inset 0 0 6px rgba(0,0,0,.3);background-color:#d9d9d9}"]
                }] }
    ];
    /** @nocollapse */
    PopupDialog.ctorParameters = function () { return [
        { type: ComponentFactoryResolver },
        { type: MatDialogRef },
        { type: undefined, decorators: [{ type: Inject, args: [MAT_DIALOG_DATA,] }] }
    ]; };
    PopupDialog.propDecorators = {
        popupContentViewContainer: [{ type: ViewChild, args: ['popupContent', { read: ViewContainerRef },] }],
        dialogContainerRef: [{ type: ViewChild, args: ['dialogContainer',] }],
        onMouseDown: [{ type: HostListener, args: ['document:mousedown', ['$event'],] }],
        onMouseUp: [{ type: HostListener, args: ['document:mouseup', ['$event'],] }],
        onClick: [{ type: HostListener, args: ['document:click', ['$event'],] }]
    };
    return PopupDialog;
}());
export { PopupDialog };
if (false) {
    /** @type {?} */
    PopupDialog.prototype.popupContentViewContainer;
    /**
     * @type {?}
     * @protected
     */
    PopupDialog.prototype.dialogContainerRef;
    /** @type {?} */
    PopupDialog.prototype.dialogResult;
    /** @type {?} */
    PopupDialog.prototype.visible;
    /** @type {?} */
    PopupDialog.prototype.isOpened;
    /** @type {?} */
    PopupDialog.prototype.scaleBottomToTop;
    /** @type {?} */
    PopupDialog.prototype.direction;
    /** @type {?} */
    PopupDialog.prototype.config;
    /** @type {?} */
    PopupDialog.prototype.data;
    /** @type {?} */
    PopupDialog.prototype.scrollBoundedFunction;
    /** @type {?} */
    PopupDialog.prototype.lastClickedElement;
    /** @type {?} */
    PopupDialog.prototype.mouseDownHandled;
    /** @type {?} */
    PopupDialog.prototype.mouseUpHandled;
    /** @type {?} */
    PopupDialog.prototype.clickHandled;
    /**
     * @type {?}
     * @private
     */
    PopupDialog.prototype.componentFactoryResolver;
    /** @type {?} */
    PopupDialog.prototype.dialogRef;
    /* Skipping unhandled member: ;*/
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9wdXAtZGlhbG9nLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmd4LXBvcHVwLWRpYWxvZy8iLCJzb3VyY2VzIjpbImxpYi9wb3B1cC1kaWFsb2cvcG9wdXAtZGlhbG9nLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFDQSxPQUFPLEVBQ0wsU0FBUyxFQUNULHdCQUF3QixFQUN4QixVQUFVLEVBQ1YsWUFBWSxFQUNaLE1BQU0sRUFDTixrQkFBa0IsRUFHbEIsU0FBUyxFQUNULGdCQUFnQixFQUNoQixpQkFBaUIsRUFDakIsY0FBYyxHQUNmLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxlQUFlLEVBQUUsZUFBZSxFQUFFLFlBQVksRUFBRSxNQUFNLDBCQUEwQixDQUFDOztBQUcxRixNQUFNLEtBQU8sa0JBQWtCLEdBQUcsSUFBSSxjQUFjLENBQThCLG9CQUFvQixDQUFDOzs7O0FBSXZHLHVDQUdDOzs7SUFGQyw4Q0FBdUI7O0lBQ3ZCLHNDQUFpRDs7Ozs7QUFHbkQscUNBR0M7OztJQUZDLGlDQUEwQjs7SUFDMUIsK0JBQVU7Ozs7O0FBR1osNEJBUUM7OztJQVBDLDRCQUFhOztJQUNiLHdDQUF5Qjs7SUFDekIsNkJBQWM7O0lBQ2QsK0JBQWdCOztJQUNoQiw4QkFBZTs7SUFDZiw0QkFBYTs7SUFDYiw0QkFBYTs7QUFHZjtJQWlCRSxxQkFDVSx3QkFBa0QsRUFDbkQsU0FBb0MsRUFDbEIsSUFBcUI7UUFGdEMsNkJBQXdCLEdBQXhCLHdCQUF3QixDQUEwQjtRQUNuRCxjQUFTLEdBQVQsU0FBUyxDQUEyQjtRQVQ3QyxZQUFPLEdBQUcsS0FBSyxDQUFDO1FBQ2hCLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIscUJBQWdCLEdBQUcsS0FBSyxDQUFDO1FBY3pCLDBCQUFxQixHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDOztRQVNqRCxxQkFBZ0IsR0FBRyxJQUFJLENBQUM7UUFDeEIsbUJBQWMsR0FBRyxJ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Q0FBQztJQUNmLENBQUM7O2dCQXhQRixTQUFTLFNBQUM7b0JBQ1QsUUFBUSxFQUFFLGNBQWM7b0JBQ3hCLGtaQUFnQztvQkFFaEMsYUFBYSxFQUFFLGlCQUFpQixDQUFDLElBQUk7O2lCQUN0Qzs7OztnQkE1Q0Msd0JBQXdCO2dCQVlpQixZQUFZO2dEQStDbEQsTUFBTSxTQUFDLGVBQWU7Ozs0Q0FieEIsU0FBUyxTQUFDLGNBQWMsRUFBRSxFQUFFLElBQUksRUFBRSxnQkFBZ0IsRUFBRTtxQ0FDcEQsU0FBUyxTQUFDLGlCQUFpQjs4QkErQjNCLFlBQVksU0FBQyxvQkFBb0IsRUFBRSxDQUFDLFFBQVEsQ0FBQzs0QkFNN0MsWUFBWSxTQUFDLGtCQUFrQixFQUFFLENBQUMsUUFBUSxDQUFDOzBCQVkzQyxZQUFZLFNBQUMsZ0JBQWdCLEVBQUUsQ0FBQyxRQUFRLENBQUM7O0lBaU01QyxrQkFBQztDQUFBLEFBMVBELElBMFBDO1NBcFBZLFdBQVc7OztJQUN0QixnREFBbUc7Ozs7O0lBQ25HLHlDQUF1RTs7SUFDdkUsbUNBQWtCOztJQUNsQiw4QkFBZ0I7O0lBQ2hCLCtCQUFpQjs7SUFDakIsdUNBQXlCOztJQUN6QixnQ0FBMEI7O0lBRTFCLDZCQUEwQjs7SUFDMUIsMkJBQVU7O0lBVVYsNENBQWlEOztJQU9qRCx5Q0FBbUI7O0lBRW5CLHVDQUF3Qjs7SUFDeEIscUNBQXNCOztJQUN0QixtQ0FBb0I7Ozs7O0lBbkJsQiwrQ0FBMEQ7O0lBQzFELGdDQUEyQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudFR5cGUgfSBmcm9tICdAYW5ndWxhci9jZGsvcG9ydGFsJztcbmltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgQ29tcG9uZW50RmFjdG9yeVJlc29sdmVyLFxuICBFbGVtZW50UmVmLFxuICBIb3N0TGlzdGVuZXIsXG4gIEluamVjdCxcbiAgUmVmbGVjdGl2ZUluamVjdG9yLFxuICBUZW1wbGF0ZVJlZixcbiAgVHlwZSxcbiAgVmlld0NoaWxkLFxuICBWaWV3Q29udGFpbmVyUmVmLFxuICBWaWV3RW5jYXBzdWxhdGlvbixcbiAgSW5qZWN0aW9uVG9rZW4sXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTUFUX0RJQUxPR19EQVRBLCBNYXREaWFsb2dDb25maWcsIE1hdERpYWxvZ1JlZiB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2RpYWxvZyc7XG5pbXBvcnQgeyBQb3B1cERpYWxvZ1NlcnZpY2VDb25maWcgfSBmcm9tICcuL3BvcHVwLWRpYWxvZy5zZXJ2aWNlJztcblxuZXhwb3J0IGNvbnN0IFBPUFVQX0RJQUxPR19DTE9TRSA9IG5ldyBJbmplY3Rpb25Ub2tlbjwoZGlhbG9nUmVzdWx0OiBhbnkpID0+IHZvaWQ+KCdQT1BVUF9ESUFMT0dfQ0xPU0UnKTtcblxuZXhwb3J0IGRlY2xhcmUgdHlwZSBEaXJlY3Rpb24gPSAnbHRyJyB8ICdydGwnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFBvcHVwRGlhbG9nQ29uZmlnIGV4dGVuZHMgUG9wdXBEaWFsb2dTZXJ2aWNlQ29uZmlnIHtcbiAgdHJpZ2dlcmluZ0VsZW1lbnQ6IGFueTtcbiAgY29tcG9uZW50OiBDb21wb25lbnRUeXBlPGFueT4gfCBUZW1wbGF0ZVJlZjxhbnk+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBvcHVwRGlhbG9nRGF0YSB7XG4gIGNvbmZpZzogUG9wdXBEaWFsb2dDb25maWc7XG4gIGRhdGE6IGFueTtcbn1cblxuaW50ZXJmYWNlIE91dE9mVmlld3BvcnQge1xuICB0b3A6IGJvb2xlYW47XG4gIHRvcElmU2NhbGVUb1RvcDogYm9vbGVhbjtcbiAgbGVmdDogYm9vbGVhbjtcbiAgYm90dG9tOiBib29sZWFuO1xuICByaWdodDogYm9vbGVhbjtcbiAgYW55OiBib29sZWFuO1xuICBhbGw6IGJvb2xlYW47XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ3BvcHVwLWRpYWxvZycsXG4gIHRlbXBsYXRlVXJsOiAncG9wdXAtZGlhbG9nLmh0bWwnLFxuICBzdHlsZVVybHM6IFsncG9wdXAtZGlhbG9nLmNzcyddLFxuICBlbmNhcHN1bGF0aW9uOiBWaWV3RW5jYXBzdWxhdGlvbi5Ob25lXG59KVxuZXhwb3J0IGNsYXNzIFBvcHVwRGlhbG9nIHtcbiAgQFZpZXdDaGlsZCgncG9wdXBDb250ZW50JywgeyByZWFkOiBWaWV3Q29udGFpbmVyUmVmIH0pIHBvcHVwQ29udGVudFZpZXdDb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XG4gIEBWaWV3Q2hpbGQoJ2RpYWxvZ0NvbnRhaW5lcicpIHByb3RlY3RlZCBkaWFsb2dDb250YWluZXJSZWY6IEVsZW1lbnRSZWY7XG4gIGRpYWxvZ1Jlc3VsdDogYW55O1xuICB2aXNpYmxlID0gZmFsc2U7XG4gIGlzT3BlbmVkID0gZmFsc2U7XG4gIHNjYWxlQm90dG9tVG9Ub3AgPSBmYWxzZTtcbiAgZGlyZWN0aW9uPzogJ2x0cicgfCAncnRsJztcblxuICBjb25maWc6IFBvcHVwRGlhbG9nQ29uZmlnO1xuICBkYXRhOiBhbnk7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgY29tcG9uZW50RmFjdG9yeVJlc29sdmVyOiBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gICAgcHVibGljIGRpYWxvZ1JlZjogTWF0RGlhbG9nUmVmPFBvcHVwRGlhbG9nPixcbiAgICBASW5qZWN0KE1BVF9ESUFMT0dfREFUQSkgZGF0YTogUG9wdXBEaWFsb2dEYXRhKSB7XG4gICAgdGhpcy5jb25maWcgPSBkYXRhLmNvbmZpZztcbiAgICB0aGlzLmRhdGEgPSBkYXRhLmRhdGE7XG4gICAgdGhpcy5kaXJlY3Rpb24gPSBkYXRhLmNvbmZpZy5kaXJlY3Rpb24gfHwgZ2V0Q29tcHV0ZWRTdHlsZSh0aGlzLmNvbmZpZy50cmlnZ2VyaW5nRWxlbWVudCkuZGlyZWN0aW9uIGFzICgnbHRyJyB8ICdydGwnKVxuICB9XG5cbiAgc2Nyb2xsQm91bmRlZEZ1bmN0aW9uID0gdGhpcy5vblNjcm9sbC5iaW5kKHRoaXMpO1xuXG4gIG9uU2Nyb2xsKGV2ZW50KSB7XG4gICAgdGhpcy5wb3NpdGlvbkRpYWxvZ1doZXJlVHJpZ2dlcmluZ0VsZW1lbnQoKTtcbiAgICB0aGlzLnBvc2l0aW9uRGlhbG9nVXBJZkJvdHRvbU91dHNpZGVWaWV3cG9ydCgpO1xuICB9XG5cbiAgbGFzdENsaWNrZWRFbGVtZW50O1xuICAvLyBzZXQgZXZlbnRzIGhhbmRsZWQgdG8gdHJ1ZSB0byBpZ25vcmUgZXZlbnQgd2hlbiBwb3B1cCBvcGVuZWQgZm9yIHRoZSBmaXJzdCB0aW1lLlxuICBtb3VzZURvd25IYW5kbGVkID0gdHJ1ZTtcbiAgbW91c2VVcEhhbmRsZWQgPSB0cnVlO1xuICBjbGlja0hhbmRsZWQgPSB0cnVlO1xuXG4gIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50Om1vdXNlZG93bicsIFsnJGV2ZW50J10pXG4gIG9uTW91c2VEb3duKGV2ZW50OiBFdmVudCkge1xuICAgIHRoaXMuaGFuZGxlTW91c2VFdmVudChldmVudCk7XG4gICAgdGhpcy5tb3VzZURvd25IYW5kbGVkID0gdHJ1ZTtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50Om1vdXNldXAnLCBbJyRldmVudCddKVxuICBvbk1vdXNlVXAoZXZlbnQ6IEV2ZW50KSB7XG4gICAgaWYgKHRoaXMubW91c2VEb3duSGFuZGxlZCB8fCB0aGlzLmNsaWNrSGFuZGxlZCkge1xuICAgICAgdGhpcy5tb3VzZURvd25IYW5kbGVkID0gZmFsc2U7XG4gICAgICB0aGlzLmNsaWNrSGFuZGxlZCA9IGZhbHNlO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuaGFuZGxlTW91c2VFdmVudChldmVudCk7XG4gICAgdGhpcy5tb3VzZVVwSGFuZGxlZCA9IHRydWU7XG4gIH1cblxuICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDpjbGljaycsIFsnJGV2ZW50J10pXG4gIG9uQ2xpY2soZXZlbnQ6IEV2ZW50KSB7XG4gICAgaWYgKHRoaXMubW91c2VEb3duSGFuZGxlZCB8fCB0aGlzLm1vdXNlVXBIYW5kbGVkKSB7XG4gICAgICB0aGlzLm1vdXNlRG93bkhhbmRsZWQgPSBmYWxzZTtcbiAgICAgIHRoaXMubW91c2VVcEhhbmRsZWQgPSBmYWxzZTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmhhbmRsZU1vdXNlRXZlbnQoZXZlbnQpO1xuICAgIHRoaXMuY2xpY2tIYW5kbGVkID0gdHJ1ZTtcbiAgfVxuXG4gIGhhbmRsZU1vdXNlRXZlbnQoZXZlbnQ6IEV2ZW50KSB7XG4gICAgaWYgKCF0aGlzLmlzT3BlbmVkKSByZXR1cm47XG5cbiAgICAvLyBDbGlja2luZyBvbiBlbGVtZW50IHdpbGwgdHJpZ2dlciB0aGlzIGNhbGxiYWNrIGZ1bmN0aW9uIG11bHRpcGxlIHRpbWVzIChmb3IgbW91c2UgZG93biwgdXAgYW5kIGNsaWNrKVxuICAgIC8vIFRoZXJlZm9yLCB3ZSBzdG9wIGV4ZWN1dGlvbiBpZiB3ZSBnZXQgdGhlIHNhbWUgZXZlbnQgdGFyZ2V0LlxuICAgIC8vIFdlIHJlc2V0IHRoZSBsYXN0Q2xpY2tlZEVsZW1lbnQgYWZ0ZXIgMTAwIG1zXG4gICAgaWYgKHRoaXMubGFzdENsaWNrZWRFbGVtZW50ID09IGV2ZW50LnRhcmdldCkgcmV0dXJuO1xuICAgIHRoaXMubGFzdENsaWNrZWRFbGVtZW50ID0gZXZlbnQudGFyZ2V0O1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgdGhpcy5sYXN0Q2xpY2tlZEVsZW1lbnQgPSBudWxsO1xuICAgIH0sIDIwMCk7XG5cbiAgICB2YXIgY29udGFpbmVyID0gdGhpcy5kaWFsb2dDb250YWluZXJSZWYubmF0aXZlRWxlbWVudDtcbiAgICBpZiAoY29udGFpbmVyID09PSBldmVudC50YXJnZXQgfHwgdGhpcy5jaGlsZE9mKGV2ZW50LnRhcmdldCwgY29udGFpbmVyKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAodGhpcy5jb25maWcuc3VwcHJlc3NDbG9zZU9uQ2xpY2tTZWxlY3RvcnMpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5jb25maWcuc3VwcHJlc3NDbG9zZU9uQ2xpY2tTZWxlY3RvcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3Qgc2VsZWN0b3IgPSB0aGlzLmNvbmZpZy5zdXBwcmVzc0Nsb3NlT25DbGlja1NlbGVjdG9yc1tpXTtcbiAgICAgICAgY29uc3QgZWxlbWVudHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9yKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGNvbnN0IGVsZW0gPSBlbGVtZW50c1tpXTtcbiAgICAgICAgICBpZiAoZWxlbSA9PT0gZXZlbnQudGFyZ2V0IHx8IHRoaXMuY2hpbGRPZihldmVudC50YXJnZXQsIGVsZW0pKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5jbG9zZURpYWxvZygpO1xuICB9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5yZWdpc3Rlck9yVW5yZWdpc3RlckFuY2VzdHJvc1Njcm9sbEV2ZW50KCk7XG4gICAgdGhpcy5sb2FkQ29tcG9uZW50KCk7XG4gICAgdGhpcy5kaWFsb2dSZWYuYmVmb3JlQ2xvc2UoKS5zdWJzY3JpYmUoeCA9PiB7XG4gICAgICB0aGlzLnZpc2libGUgPSBmYWxzZTtcbiAgICAgIHRoaXMuaXNPcGVuZWQgPSBmYWxzZTtcbiAgICB9KVxuICAgIHRoaXMuZGlhbG9nUmVmLmFmdGVyT3BlbigpLnN1YnNjcmliZSh4ID0+IHtcbiAgICAgIHRoaXMuaXNPcGVuZWQgPSB0cnVlO1xuICAgIH0pXG4gICAgdGhpcy5wb3NpdGlvbkRpYWxvZ1doZXJlVHJpZ2dlcmluZ0VsZW1lbnQoKTtcbiAgICB0aGlzLnBvc2l0aW9uRGlhbG9nVXBJZkJvdHRvbU91dHNpZGVWaWV3cG9ydCgpO1xuICAgIHRoaXMudmlzaWJsZSA9IHRydWU7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnJlZ2lzdGVyT3JVbnJlZ2lzdGVyQW5jZXN0cm9zU2Nyb2xsRXZlbnQoZmFsc2UpO1xuICB9XG5cbiAgbG9hZENvbXBvbmVudCgpIHtcbiAgICBsZXQgY29tcG9uZW50RmFjdG9yeSA9IHRoaXMuY29tcG9uZW50RmFjdG9yeVJlc29sdmVyLnJlc29sdmVDb21wb25lbnRGYWN0b3J5KHRoaXMuY29uZmlnLmNvbXBvbmVudCBhcyBUeXBlPGFueT4pO1xuXG4gICAgdGhpcy5wb3B1cENvbnRlbnRWaWV3Q29udGFpbmVyLmNsZWFyKCk7XG5cbiAgICBjb25zdCBpbmplY3RvciA9IFJlZmxlY3RpdmVJbmplY3Rvci5yZXNvbHZlQW5kQ3JlYXRlKFtcbiAgICAgIHtcbiAgICAgICAgcHJvdmlkZTogTUFUX0RJQUxPR19EQVRBLFxuICAgICAgICB1c2VWYWx1ZTogdGhpcy5kYXRhIHx8IHt9XG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBwcm92aWRlOiBQT1BVUF9ESUFMT0dfQ0xPU0UsXG4gICAgICAgIHVzZVZhbHVlOiB0aGlzLmNsb3NlRGlhbG9nLmJpbmQodGhpcylcbiAgICAgIH1cbiAgICBdKTtcbiAgICBsZXQgY29tcG9uZW50UmVmID0gdGhpcy5wb3B1cENvbnRlbnRWaWV3Q29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChjb21wb25lbnRGYWN0b3J5LCAwLCBpbmplY3Rvcik7XG4gIH1cblxuICBjb250YWluZXJUcmFuc2l0aW9uRW5kKGV2ZW50OiBFdmVudCkge1xuICAgIGlmIChldmVudC50YXJnZXQgPT0gdGhpcy5kaWFsb2dDb250YWluZXJSZWYubmF0aXZlRWxlbWVudCAmJiAhdGhpcy52aXNpYmxlKSB7XG4gICAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZSh0aGlzLmRpYWxvZ1Jlc3VsdCk7XG4gICAgfVxuICB9XG5cbiAgY2xvc2VEaWFsb2coZGlhbG9nUmVzdWx0PzogYW55KSB7XG4gICAgdGhpcy5kaWFsb2dSZXN1bHQgPSBkaWFsb2dSZXN1bHQ7XG4gICAgdGhpcy52aXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5pc09wZW5lZCA9IGZhbHNlO1xuICB9XG5cbiAgcHJpdmF0ZSByZWdpc3Rlck9yVW5yZWdpc3RlckFuY2VzdHJvc1Njcm9sbEV2ZW50KHJlZ2lzdGVyID0gdHJ1ZSkge1xuICAgIGxldCBlbGVtID0gKHRoaXMuY29uZmlnLnRyaWdnZXJpbmdFbGVtZW50IGFzIE5vZGUpLnBhcmVudE5vZGU7XG4gICAgd2hpbGUgKGVsZW0gIT09IG51bGwpIHtcbiAgICAgIHJlZ2lzdGVyID9cbiAgICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHRoaXMuc2Nyb2xsQm91bmRlZEZ1bmN0aW9uKSA6XG4gICAgICAgIGVsZW0ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInNjcm9sbFwiLCB0aGlzLnNjcm9sbEJvdW5kZWRGdW5jdGlvbik7XG4gICAgICBlbGVtID0gZWxlbS5wYXJlbnROb2RlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgcG9zaXRpb25EaWFsb2dXaGVyZVRyaWdnZXJpbmdFbGVtZW50KCkge1xuICAgIGNvbnN0IG1hdERpYWxvZ0NvbmZpZzogTWF0RGlhbG9nQ29uZmlnID0gbmV3IE1hdERpYWxvZ0NvbmZpZygpO1xuICAgIGNvbnN0IHJlY3QgPSB0aGlzLmNvbmZpZy50cmlnZ2VyaW5nRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBsZXQgdG9wID0gdGhpcy5jb25maWcuY292ZXJUcmlnZ2VyaW5nRWxlbWVudCA/XG4gICAgICByZWN0LmJvdHRvbSAtIHRoaXMuY29uZmlnLnRyaWdnZXJpbmdFbGVtZW50Lm9mZnNldEhlaWdodCAtIDEgOlxuICAgICAgcmVjdC5ib3R0b21cblxuICAgIG1hdERpYWxvZ0NvbmZpZy5wb3NpdGlvbiA9IHsgdG9wOiBgJHt0b3B9cHhgIH07XG4gICAgaWYgKHRoaXMuZGlyZWN0aW9uID09ICdydGwnKSB7XG4gICAgICBsZXQgcmlnaHQgPSB3aW5kb3cuaW5uZXJXaWR0aCAtIHJlY3QubGVmdCAtIHRoaXMuY29uZmlnLnRyaWdnZXJpbmdFbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgbWF0RGlhbG9nQ29uZmlnLnBvc2l0aW9uLnJpZ2h0ID0gYCR7cmlnaHR9cHhgO1xuICAgIH0gZWxzZSB7XG4gICAgICBtYXREaWFsb2dDb25maWcucG9zaXRpb24ubGVmdCA9IGAke3JlY3QubGVmdH1weGA7XG4gICAgfVxuXG4gICAgdGhpcy5kaWFsb2dSZWYudXBkYXRlUG9zaXRpb24obWF0RGlhbG9nQ29uZmlnLnBvc2l0aW9uKTtcbiAgfVxuXG4gIHByaXZhdGUgcG9zaXRpb25EaWFsb2dVcElmQm90dG9tT3V0c2lkZVZpZXdwb3J0KCkge1xuICAgIGlmICghdGhpcy5jb25maWcuc2NhbGVUb1RvcE9uQm90dG9tT3ZlcmZsb3cpIHJldHVybjtcblxuICAgIGxldCBkaWFsb2dDb250YWluZXJFbGVtID0gdGhpcy5kaWFsb2dDb250YWluZXJSZWYubmF0aXZlRWxlbWVudCBhcyBIVE1MRWxlbWVudDtcbiAgICBsZXQgcmVzdWx0ID0gdGhpcy5pc091dE9mVmlld3BvcnQoKTtcblxuICAgIGlmIChyZXN1bHQuYm90dG9tICYmICFyZXN1bHQudG9wSWZTY2FsZVRvVG9wKSB7XG4gICAgICB0aGlzLnNjYWxlQm90dG9tVG9Ub3AgPSB0cnVlO1xuICAgICAgY29uc3QgbWF0RGlhbG9nQ29uZmlnOiBNYXREaWFsb2dDb25maWcgPSBuZXcgTWF0RGlhbG9nQ29uZmlnKCk7XG4gICAgICBjb25zdCByZWN0ID0gZGlhbG9nQ29udGFpbmVyRWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgIGxldCB0cmlnZ2VyaW5nRWxlbWVudEhlaWdodCA9IHRoaXMuY29uZmlnLnRyaWdnZXJpbmdFbGVtZW50Lm9mZnNldEhlaWdodDtcbiAgICAgIGxldCB0b3AgPSB0aGlzLmNvbmZpZy5jb3ZlclRyaWdnZXJpbmdFbGVtZW50ID9cbiAgICAgICAgcmVjdC50b3AgLSBkaWFsb2dDb250YWluZXJFbGVtLm9mZnNldEhlaWdodCArIHRyaWdnZXJpbmdFbGVtZW50SGVpZ2h0ICsgMSA6XG4gICAgICAgIHJlY3QudG9wIC0gZGlhbG9nQ29udGFpbmVyRWxlbS5vZmZzZXRIZWlnaHQgLSB0cmlnZ2VyaW5nRWxlbWVudEhlaWdodFxuXG4gICAgICBtYXREaWFsb2dDb25maWcucG9zaXRpb24gPSB7IHRvcDogYCR7dG9wfXB4YCB9O1xuICAgICAgaWYgKHRoaXMuZGlyZWN0aW9uID09ICdydGwnKSB7XG4gICAgICAgIGxldCByaWdodCA9IHdpbmRvdy5pbm5lcldpZHRoIC0gcmVjdC5sZWZ0IC0gdGhpcy5jb25maWcudHJpZ2dlcmluZ0VsZW1lbnQub2Zmc2V0V2lkdGg7XG4gICAgICAgIG1hdERpYWxvZ0NvbmZpZy5wb3NpdGlvbi5yaWdodCA9IGAke3JpZ2h0fXB4YDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG1hdERpYWxvZ0NvbmZpZy5wb3NpdGlvbi5sZWZ0ID0gYCR7cmVjdC5sZWZ0fXB4YDtcbiAgICAgIH1cblxuICAgICAgdGhpcy5kaWFsb2dSZWYudXBkYXRlUG9zaXRpb24obWF0RGlhbG9nQ29uZmlnLnBvc2l0aW9uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zY2FsZUJvdHRvbVRvVG9wID0gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpc091dE9mVmlld3BvcnQoKTogT3V0T2ZWaWV3cG9ydCB7XG4gICAgbGV0IGNvbnRhaW5lciA9IHRoaXMuZGlhbG9nQ29udGFpbmVyUmVmLm5hdGl2ZUVsZW1lbnQ7XG4gICAgbGV0IHRyaWdnZXJpbmdFbGVtZW50ID0gdGhpcy5jb25maWcudHJpZ2dlcmluZ0VsZW1lbnQ7XG4gICAgLy8gR2V0IGVsZW1lbnQncyBib3VuZGluZ1xuICAgIHZhciBib3VuZGluZyA9IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcblxuICAgIC8vIHJlZHVjZSBoZWlnaHQgZnJvbSB0b3AgcG9zaXRpb24gaWYgc2NhbGUgdG8gdG9wXG4gICAgbGV0IHRvcCA9IGJvdW5kaW5nLnRvcDtcbiAgICBpZiAodGhpcy5zY2FsZUJvdHRvbVRvVG9wKSB7XG4gICAgICB0b3AgPSB0aGlzLmNvbmZpZy5jb3ZlclRyaWdnZXJpbmdFbGVtZW50ID9cbiAgICAgICAgYm91bmRpbmcudG9wIC0gY29udGFpbmVyLm9mZnNldEhlaWdodCArIHRyaWdnZXJpbmdFbGVtZW50Lm9mZnNldEhlaWdodCA6XG4gICAgICAgIGJvdW5kaW5nLnRvcCAtIGNvbnRhaW5lci5vZmZzZXRIZWlnaHQgLSB0cmlnZ2VyaW5nRWxlbWVudC5vZmZzZXRIZWlnaHRcbiAgICB9XG5cbiAgICBsZXQgdG9wSWZTY2FsZVRvVG9wID0gdG9wO1xuICAgIGlmICghdGhpcy5zY2FsZUJvdHRvbVRvVG9wKSB7XG4gICAgICB0b3BJZlNjYWxlVG9Ub3AgPSB0b3AgLSAodGhpcy5jb25maWcuY292ZXJUcmlnZ2VyaW5nRWxlbWVudCA/IGNvbnRhaW5lci5vZmZzZXRIZWlnaHQgLSB0cmlnZ2VyaW5nRWxlbWVudC5vZmZzZXRIZWlnaHQgOiBjb250YWluZXIub2Zmc2V0SGVpZ2h0ICsgdHJpZ2dlcmluZ0VsZW1lbnQub2Zmc2V0SGVpZ2h0KTtcbiAgICB9XG5cbiAgICB2YXIgb3V0OiBhbnkgPSB7fTtcbiAgICBvdXQudG9wID0gdG9wIDwgMDtcbiAgICBvdXQudG9wSWZTY2FsZVRvVG9wID0gdG9wSWZTY2FsZVRvVG9wIDwgMDtcbiAgICBvdXQubGVmdCA9IGJvdW5kaW5nLmxlZnQgPCAwO1xuICAgIG91dC5ib3R0b20gPSAoYm91bmRpbmcudG9wICsgY29udGFpbmVyLm9mZnNldEhlaWdodCkgPiAod2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpO1xuICAgIGlmICh0aGlzLnNjYWxlQm90dG9tVG9Ub3AgJiYgIW91dC5ib3R0b20pIHtcbiAgICAgIGlmICghb3V0LnRvcCkgb3V0LmJvdHRvbSA9IHRydWU7XG4gICAgfVxuICAgIG91dC5yaWdodCA9IChib3VuZGluZy5sZWZ0ICsgY29udGFpbmVyLm9mZnNldFdpZHRoKSA+ICh3aW5kb3cuaW5uZXJXaWR0aCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0V2lkdGgpO1xuICAgIG91dC5hbnkgPSBvdXQudG9wIHx8IG91dC5sZWZ0IHx8IG91dC5ib3R0b20gfHwgb3V0LnJpZ2h0O1xuICAgIG91dC5hbGwgPSBvdXQudG9wICYmIG91dC5sZWZ0ICYmIG91dC5ib3R0b20gJiYgb3V0LnJpZ2h0O1xuXG4gICAgcmV0dXJuIG91dDtcbiAgfTtcblxuICBwcml2YXRlIGNoaWxkT2Yobm9kZSwgYW5jZXN0b3IpIHtcbiAgICB2YXIgY2hpbGQgPSBub2RlO1xuICAgIHdoaWxlIChjaGlsZCAhPT0gbnVsbCkge1xuICAgICAgaWYgKGNoaWxkID09PSBhbmNlc3RvcikgcmV0dXJuIHRydWU7XG4gICAgICBjaGlsZCA9IGNoaWxkLnBhcmVudE5vZGU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG59XG4iXX0=